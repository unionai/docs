{{- $variant := .Site.Params.variant -}} {{- $access := partial
"page-allowed.html" . -}} {{- if $access.allowed -}}
<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ .Title }} | {{ .Site.Title }}</title>
    <link rel="icon" href="{{ "images/favicon.ico" | relURL }}"/>
    <link rel="stylesheet" href="{{ "css/api.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/base.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/breadcrumb.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/card.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/footer.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/header.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/images.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/markdown.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/sidebar.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/tabs.css" | relURL }}" />
    <link rel="stylesheet" href="{{ "css/toc.css" | relURL }}" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.0/cdn/themes/light.css" />
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
    <script type="module"
      src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.0/cdn/shoelace-autoloader.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.32.2/tocbot.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.32.2/tocbot.min.js"></script>
    <script>
      // Function to set the theme based on preference
      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);

        // Set the theme in the HTML element
        document.documentElement.className = theme === 'dark' ? 'sl-theme-dark' : '';

        // Set cookie for 24 hours
        const date = new Date();
        date.setTime(date.getTime() + (24 * 60 * 60 * 1000));
        document.cookie = `theme=${theme};expires=${date.toUTCString()};path=/`;
      }

      // Function to get cookie value
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }

      // Check for saved theme preference
      const savedTheme = localStorage.getItem('theme') || getCookie('theme');

      // Check for system preference if no saved preference
      if (!savedTheme && window.matchMedia) {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        setTheme(prefersDark ? 'dark' : 'light');
      } else if (savedTheme) {
        setTheme(savedTheme);
      } else {
        setTheme('light'); // Default to light if no preference detected
      }
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        tocbot.init({
          tocSelector: '.toc',
          contentSelector: '.main-content',
          headingSelector: 'h1, h2, h3',
          collapseDepth: 6, // Show all levels
          scrollSmooth: true,
          scrollSmoothDuration: 420,
          activeLinkClass: 'is-active-link',
          headingLabelCallback: (string) => string,
          positionFixedSelector: '.toc',
          positionFixedClass: 'is-fixed',
          fixedSidebarOffset: 0,
        });
      });
    </script>
    <link rel="stylesheet" href="{{ "css/responsive.css" | relURL }}" />
  </head>
  <body>
    <header>{{ partial "header.html" . }}</header>
    <div class="tabs">{{ partial "tabs.html" (dict "page" .) }}</div>
    <div class="container">
      <div class="sidebar">{{ partial "sidebar.html" . }}</div>
      <div class="main-content">
        {{ if $access.development }}
        <div class="
          not-in-prod
          {{ if not $access.excluded }}not-allowed{{end}}
          {{ if $access.excluded }}excluded{{end}}
          page-warn
          ">
          <div style="flex: 1">
            {{ if $access.excluded }}
            This page was explicitly excluded from '{{ $variant }}'.
            {{ else }}
            This page visibility is not declared for '{{ $variant }}'.
            <div class="not-allowed how-to-fix">
              <a href="https://github.com/unionai/docs-builder/blob/master/AUTHOR.md#page-visibility">How to fix?</a>
            </div>
            {{ end }}
          </div>
          <code>{{ strings.TrimSuffix "/" .RelPermalink }}</code>
        </div>
        {{ end }}
        {{ partial "breadcrumb.html" . }}
        {{ block "main" . }}{{ end }}
      </div>
      {{ partial "toc.html" . }}
    </div>
  </body>
</html>
{{- end -}}

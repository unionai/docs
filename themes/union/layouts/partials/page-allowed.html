{{- /* Check if the current page is in the allowed list */ -}}
{{- $variant := .Site.Params.variant -}}

{{- $isAllowed := false -}}
{{- $isExcluded := false -}}

{{- $path := "" }}
{{- with.File -}}
    {{- $path = replaceRE "\\.md$" "" .Path -}}
    {{- $path = replaceRE "/_index" "" $path -}}
    {{- $path = replaceRE "_index" "" $path -}}
    {{- $path = printf "%s%s" "/" $path -}}
{{- else -}}
    {{- $path = "/" -}}
{{- end -}}

{{- $entry := index (index (index .Site.Data.pages $variant) "pages") $path }}

{{- $isAllowed := and (ne $entry nil) (ne $entry "exclude") }}
{{- $isExcluded := eq $entry "exclude" }}

{{-
    return dict 
        "allowed" (or $isAllowed (and (not hugo.IsProduction) (not .Site.Params.variant_hide_in_development)))
        "excluded" (and $isExcluded (not hugo.IsProduction))
        "development" (and (not $isAllowed) (not hugo.IsProduction))
        "variant" $isAllowed
-}}
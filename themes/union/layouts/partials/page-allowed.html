{{- /* Check if the current page is in the allowed list */ -}}
{{- $variant := .Site.Params.variant -}}
{{- $allowedPages := index (index .Site.Data.pages.variants $variant) "pages" -}}
{{- $excludedPages := index (index .Site.Data.pages.variants $variant) "exclude" | default (slice) -}}
{{- $isAllowed := false -}}
{{- $isExcluded := false -}}

{{- if .Path -}}
    {{- $currentPath := .Path -}}
    {{- range $allowedPages -}}
        {{- if eq $currentPath . -}}
            {{- $isAllowed = true -}}
        {{- else -}}
            {{- /* check if first path is the variant */ -}}
            {{- $currentPath := split $currentPath "/" -}}
            {{- if eq (index $currentPath 0) $variant -}}
                {{- $currentPath := delimit (after 1 $currentPath) "/" -}}
                {{- if eq $currentPath . -}}
                    {{- $isAllowed = true -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
    {{- range $excludedPages -}}
        {{- if eq $currentPath . -}}
            {{- $isExcluded = true -}}
        {{- else -}}
            {{- /* check if first path is the variant */ -}}
            {{- $currentPath := split $currentPath "/" -}}
            {{- if eq (index $currentPath 0) $variant -}}
                {{- $currentPath := delimit (after 1 $currentPath) "/" -}}
                {{- if eq $currentPath . -}}
                    {{- $isExcluded = true -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
{{- end -}}

{{-
    return dict 
        "allowed" (or $isAllowed (and (not hugo.IsProduction) (not .Site.Params.variant_hide_in_development)))
        "excluded" (and $isExcluded (not hugo.IsProduction))
        "development" (and (not $isAllowed) (not hugo.IsProduction))
        "variant" $isAllowed
-}}